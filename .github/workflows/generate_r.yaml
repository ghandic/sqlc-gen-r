name: Generate R Code

on:
    push:
        branches: [ main ]
    pull_request:
        branches: [ main ]

jobs:
    generate:
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v4
        - name: Set up Go
          uses: actions/setup-go@v5
          with:
            go-version: '1.23'

        - name: Install sqlc
          run: go install github.com/sqlc-dev/sqlc/cmd/sqlc@latest

        - name: Generate R code
          run: cd example && sqlc generate

        - name: Commit changes (if any)
          run: |
            git config --local user.email "actions@github.com"
            git config --local user.name "GitHub Actions"
            git add example/db.R
            git diff --exit-code || git commit -m "Regenerate R code"
            git push